{% extends 'notebook/base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12 mb-3">
            <a href="{% url 'index' %}" class="btn btn-outline-secondary">&larr; Назад к списку</a>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h2>{{ person.last_name }} {{ person.first_name }} {{ person.patronymic|default:"" }}</h2>
            <div>
                <a href="{% url 'update' person.id %}" class="btn btn-warning btn-sm">Редактировать</a>
                <a href="{% url 'delete' person.id %}" class="btn btn-danger btn-sm"
                    onclick="return confirm('Вы уверены?');">Удалить</a>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Дата рождения:</strong> {{ person.birth_date|default:"-" }}</p>
                    <p><strong>Пол:</strong> {{ person.gender|default:"-" }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Место работы/учёбы:</strong> {{ person.workplace|default:"-" }}</p>
                    <p><strong>Должность:</strong> {{ person.position|default:"-" }}</p>
                </div>
            </div>
            {% if person.notes %}
            <div class="mt-3">
                <h5>Заметки</h5>
                <p>{{ person.notes }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">Контакты</h4>
                    <a href="{% url 'add_contact' person.id %}" class="btn btn-sm btn-success">+ Добавить</a>
                </div>
                <ul class="list-group list-group-flush">
                    {% for contact in contacts %}
                    <li class="list-group-item">
                        {% if contact.phone %}<div><strong>Телефон:</strong> {{ contact.phone }}</div>{% endif %}
                        {% if contact.email %}<div><strong>Email:</strong> {{ contact.email }}</div>{% endif %}
                        {% if contact.address %}<div><strong>Адрес:</strong> {{ contact.address }}</div>{% endif %}
                    </li>
                    {% empty %}
                    <li class="list-group-item text-muted">Нет контактов</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">Связи (Родственники/Коллеги)</h4>
                    <a href="{% url 'add_relationship' person.id %}" class="btn btn-sm btn-success">+ Добавить</a>
                </div>
                <ul class="list-group list-group-flush">
                    {% for rel in relations %}
                    <li class="list-group-item">
                        <strong>{{ rel.relationship_type }}:</strong>
                        <a href="{% url 'show' rel.related_person.id %}">{{ rel.related_person }}</a>
                        {% if rel.note %}<br><small class="text-muted">{{ rel.note }}</small>{% endif %}
                    </li>
                    {% empty %}
                    <li class="list-group-item text-muted">Нет связей</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}